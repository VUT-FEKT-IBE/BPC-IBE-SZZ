\section{Prvočísla -- popište způsob generování a~uveďte příklad pravděpodobnostního testu a~skutečného testu}

Jsou extrémně důležitá pro téměř všechny kryptosystémy: asymetrické šifrování, digitální podpisy, ustanovení klíčů i~vyšší systémy (TLS, PKI).

Prvočísel je nekonečně mnoho, počet $\pi(n)$ menší než $n$ lze pro~velké hodnoty aproximovat jako $\pi(n) = \frac{n}{\ln(n)}$. Současné kryptosystémy využívají prvočísla o~velikosti 2048-4096b (600 - 1200 cifer).

\subsection{Typy prvočísel}

\textbf{Mersennova prvočísla}: $M_p = 2^n - 1$ (např. 31). \\
\textbf{Sophie-Germain prvočísla}: $p$ pokud $2p + 1$ je také prvočíslo (např. 11). \\
\textbf{Bezpečná prvočísla}: $B_p = 2p + 1$ (např. 23).

\subsection{Generování}

Velmi neefektivním způsobem je Eratosthenovo síto. Sestaví se seznam všech čísel od~2 do~$n$. První se ze~seznamu vyřadí a~prohlásí se za~prvočíslo, všechny jeho násobky se ze~seznamu vyřadí. Takto se pokračuje dokud nedosáhneme $\sqrt{n}$, kdy zbývají pouze prvočísla.

Prakticky se buď volí bezpečná prvočísla, nebo se náhodně vygeneruje číslo požadované velikosti a~otestuje se, zda se o~prvočíslo jedná.

\subsection{Pravděpodobnostní testy}

\textbf{Fermatův test} je založen na~modulárním mocnění. Zvolíme libovolné $a: 1 \leq a \leq n-1$, spočteme $a^{n-1} \stackrel{?}{\equiv} 1 \Pmod n$. Pokud kongruence platí, opakujeme pro~jiné $a$, pokud neplatí, $n$ prvočíslo není. Čím více pokusů, tím větší šance že se o~prvočíslo jedná. Nedokáže odlišit prvočísla a~Carmichaelova čísla\footnote{%
Carmichaelovo číslo splnňuje kongurenci $b^{n-1} \equiv 1 \Pmod n$ pro~všechna $b$ nesoudělná s~$n$.
}.

\noindent \textbf{Miller-Rabinův test} je spolehlivější než~Fermatův; složená čísla projdou iterací s~maximálně 25\% pravděpodobností.

\begin{table}[ht]
\begin{tabular}{l|l}
0 & $n = 2^s r + 1$ kde $r$ je liché \\
1 & $a: 1 \leq a \leq n-1$ \\
2 & $\begin{cases}
a^r \equiv 1 \Pmod n & \mathrm{nov\acute{a}\ iterace} \\
a^r \not\equiv 1 \Pmod n & \mathrm{bod\ 3} \\
\end{cases}$ \\
3 & Platí $a^{2^i r} \equiv n-1 \Pmod n$ pro všechna $i: 0 \leq i \leq s-1$ $\begin{cases}
\mathrm{ano:} & \mathrm{nov\acute{a}\ iterace} \\
\mathrm{ne:} & \mathrm{je\ slo\check{z}en\acute{e}} \\
\end{cases}$ \\
\end{tabular}
\end{table}

\subsection{Skutečné testy}

\textbf{Lucas-Lehmerův test} funguje pouze pro~Mersenova prvočísla ($M_p = 2^s - 1$). \\
$u_0 = 4$, $u_{n+1} = (u_n^2 - 2) \Mod n$, \dots, $u_{s-2} \stackrel{?}{=} 0$.

\clearpage
\section{Teorie čísel, algebraické struktury -- popište účel a~způsob výpočtu Eulerovy funkce. Popište požadavky na grupu a způsob generování grupy pro algoritmy založené na problému DL.}

\clearpage
\section{Modulární aritmetika -- popište algoritmus Square and Multiply a Čínskou větu o zbytcích.}

Modulární aritmetika pracuje s~celými čísly v~daném intervalu. Pro~čísla platí: \\
-- \textbf{reflexivita}: $a \equiv a \Pmod n$ \\
-- \textbf{symetrie}: $a \equiv b \wedge b \equiv a \Pmod n$ \\
-- \textbf{tranzitivita}: $a \equiv b \wedge b \equiv c \Rightarrow a \equiv c \Pmod n$

\vspace*{1em} \noindent
\textbf{Malá Fermatova věta} urychluje modulární mocnění: \\
$a^p \equiv a \Pmod p$ (také \enquote{$a^p - a$ je dělitelné $p$}).

\vspace*{1em} \noindent
\textbf{Eulerova-Fermatova věta} umožňuje získat inverzní prvek: \\
$a^{-1} = a^{\phi(n) - 1} \Mod n$. Obecně platí $a^{\phi(n)} = 1 \Mod n$

\vspace*{1em} \noindent
\textbf{Rozšířený Euklidův algoritmus} umožňuje získat inverzní prvek (zde $5^{-1} \Mod 13$):

\begin{table}[ht]
	\centering
\begin{tabular}{ll|l}
	$12 = n$                               & {}                                           & \boxed{\stackrel{?}{\pm} 5} $=$ {\color{violet}2} $\cdot$ {\color{blue}2} + {\color{brown}1} (mod 12) \\
	\hline
	$5 = x$                                & {\color{violet}2} $= \lfloor 12 / 5 \rfloor$ & {\color{blue}2} = {\color{red}2} $\cdot$ {\color{brown}1} + {\color{teal}0} \\
	$2 = 12 - (5 \cdot {\color{violet}2})$ & {\color{red}2}    $= \lfloor 5 / 2 \rfloor$  & {\color{brown}1} \\
	$1 = 5 - (2 \cdot {\color{red}2})$     & {\color{purple}2} $= \lfloor 2 / 1 \rfloor$  & {\color{teal}0} \\
	$0 = 2 - (1 \cdot {\color{purple}2})$  & {}                                           & {}
\end{tabular}
\caption*{Ukázka výpočtu inverzního prvku použitím Rozšířeného Euklidova algoritmu.}
\end{table}

\noindent
Počítání probíhá nejprve v~prvních dvou sloupcích, poté zespoda nahoru ve~třetím (barvy napovídají odkud je které číslo). Po~získání výsledku je~nutné zkontrolovat znaméno (tj. je možné, že bude nutné výsledku přidat mínus a~přičíst $n$.)

\subsection{Square \& Multiply}

Urychlení modulárního mocnění příkladů typu \enquote{ $a^k \Mod p$}. Při~řešení příkladu \enquote{$5^{11} \Mod 17$} lze exponent přepsat do~binární podoby: $11_{10} = 1011_2$. Jednotlivé bity se vypíší do~sloupečku tabulky odspoda nahoru (na~prvním řádku je LSB). Postupuje se zeshora dolů, a~pokud je hodnota $k_i$ 1, vykoná se krok $b$.

\begin{table}[ht]
\centering
\begin{tabular}{c|ll}
$k_i$      & $A$                                                & $b = {\color{magenta}1}$ \\
\hline
\textbf{1} & ${\color{red}5} = a$                               & ${\color{teal}5} = {\color{magenta}1} \cdot {\color{red}5}$ \\
\textbf{1} & ${\color{violet}8} = {\color{red}5}^2 \Mod 17$     & ${\color{blue}6} = {\color{teal}5} \cdot {\color{violet}8} \Mod 17$ \\
        0  & ${\color{purple}13} = {\color{violet}8}^2 \Mod 17$ & \\
\textbf{1} & ${\color{brown}16} = {\color{purple}13}^2 \Mod 17$ & $\boxed{11} = {\color{blue}6} \cdot {\color{brown}16} \Mod 17$ \\
\end{tabular}
\caption*{Ukázka výpočtu pomocí Square \& Multiply.}
\end{table} 

\clearpage
\subsection{Čínská věta o~zbytcích}

Používá se pro~modulární mocnění. $m_1, \dots, m_k$ jsou nesoudělná čísla. $a_1, \dots, a_k \in \mathbb{Z}$. Systém

\begin{align*}
x &\equiv a_1 \,(\mathrm{mod}\, m_1) \\
x &\equiv a_2 \,(\mathrm{mod}\, m_2) \\
&\dots \\
x &\equiv a_k \,(\mathrm{mod}\, m_k) \\
\end{align*} %
má výsledné modulo $M = m_1 \cdot m_2 \cdots m_k$. Řešení lze vypočítat vzorcem

$$ x = \sum_{i=1}^{k} a_i N_i L_i \Mod M $$
kde $M = m_1 \cdot m_2 \cdots m_k$, $N_i = M / m_i$, $L_i = N_i^{-1} \Mod m_i$.

\begin{figure}[ht]
\centering
\begin{align*}
x &\equiv 3 \Pmod 6 (= a_1 \Pmod {m_1}) \\
x &\equiv 2 \Pmod 7 (= a_2 \Pmod {m_2}) \\
M = m_1 \cdot m_2 &= 6 \cdot 7 = 42 \\
N_1 = M / m_1 &= 42 / 6 = 7 \\
N_2 = M / m_2 &= 42 / 7 = 6 \\
L_1 = N_1^{-1} \Mod m_1 &= 7^{-1} \Mod 6 = 1 \\
L_2 = N_2^{-1} \Mod m_2 &= 6^{-1} \Mod 7 = 6 \\
x = (a_1 N_1 L_1 + a_2 N_2 L_2) \Mod M &= 3 \cdot 7 \cdot 1 + 2 \cdot 6 \cdot 6 \Mod 42 = \boxed{9} \\
\end{align*}
\vspace*{-4em}
\caption*{Ukázka výpočtu čínské věty o~zbytcích.}
\end{figure}

\clearpage
\section{Symetrická kryptografie -- proudové šifry, synchronní a asynchronní proudové šifry.}
\label{question-4}
% Promised by jedla97
% Je možné tu u proudových šifrer nějak zmínit PRNG, případně to doplnit u otázky 9?

\clearpage
\section{Blokové šifry -- Product Ciphers, konstrukce, Feistelova síť, DES, AES, základní módy blokových šifer.}
% Promised by jedla97

\clearpage
\section{Asymetrické algoritmy -- RSA, Diffie-Hellman, ECDH systém a jejich využití pro digitální podpis.}

Problém diskrétního logaritmu%
\footnote{\emph{Discrete Logarithm Problem}, DLP}%
: $$c = m^n \Mod p$$ je pro velká čísla neřešitelné.

\subsection[RSA]{\href{https://en.wikipedia.org/wiki/RSA_(cryptosystem)}{RSA}}

Jde o~relativně pomalý algoritmus, proto se s~ním nešifrují přenášená data samotná, ale pouze klíče pro~symetrickou kryptografii.

\begin{table}[ht]
\begin{tabular}{ll}
Vygenerování privátních prvočísel & $p, q$ \\
Vypočítání privátního čísla & $\phi(n) = (p-1)(q-1)$ \\
Vypočítání veřejného čísla & $n = r \cdot s$ \\
Vypočítání veřejného klíče & $k_{\mathrm{pub}} \in [1, n], \mathrm{GCD}(k_{\mathrm{pub}}, \phi(n)) = 1$ \\
Vypočítání privátního klíče & $k_{\mathrm{priv}} = k_{\mathrm{pub}}^{-1} \Mod \phi(n)$ \\
\end{tabular}
\end{table}

Parametry $p, q$ by měly být podobně velké, i~když s~trochu rozdílnou velikostí (pro~ztížení útoků). Jejich společné faktory by měly být co nejmenší, pokud to prvočísla nejsou. Místo funkce $\phi$ se v~praxi používá Carmichaelovu funkci $\lambda$, protože $\phi$ může generovat čísla větší než je třeba.

\begin{table}[ht]
\begin{tabular}{ll}
šifrování & $c = m^{k_{\mathrm{pub}}} \Mod n$ \\
dešifrování & $m = c^{k_{\mathrm{priv}}} \Mod n$ \\
podepisování & $\mathrm{Sig}_m = m^{k_{\mathrm{priv}}} \Mod n$ \\
ověření & $\mathrm{Sig}_m^{k_{\mathrm{priv}}} \stackrel{?}{=} m \Mod n$ \\
\end{tabular}
\end{table}

\subsection[Diffie--Hellman výměna]{\href{https://en.wikipedia.org/wiki/Diffie-Hellman_key_exchange}{Diffie-Hellman výměna}}

Veřejnými prvky jsou prvočíslo $p$ (s~velikostí nad~2048~b), prvočíslo $q$ (větší než~224~b) a~generátor $z \in \mathbb{Z}_p^*$ velikosti $q$. Jde o~systém náchylný na~MitM, klíče nejsou nijak autentizované.

\begin{table}[ht]
\begin{tabular}{lcl}
Alice && Bob \\
$1 \le a \le p-2$ && $1 \le b \le p-2$ \\
$A = g^a \Mod p$ & $\stackrel{A}{\rightarrow}$ $\stackrel{B}{\leftarrow}$ & $B = g^b \Mod p$ \\
$k = B^a \Mod p$ && $k = A^b \Mod p$ \\
\end{tabular}
\end{table}

\subsection{Diffie--Hellman výměna nad~eliptickými křivkami}

Vlastnosti ECDH jsou totožné s~DH, DLP je pouze nahrazen jeho verzí nad~křivkami (ECDLP). Násobení na~eliptických křivkách je aplikováno jako opakované přičítání bodu. Asymetrické kryptosystémy nad~eliptickými křivkami nabízí stejnou bezpečnost při~mnohem kratší délce klíče (3072~b DH $\approx$ 160~b ECDH).

\begin{table}[ht]
\begin{tabular}{lcl}
Alice && Bob \\
$a$ && $b$ \\
$A = aP \Mod p$ & $\stackrel{A}{\rightarrow}$ $\stackrel{B}{\leftarrow}$ & $B = bP \Mod p$ \\
$k = aB \Mod p$ && $k = bA \Mod p$ \\
\end{tabular}
\end{table}

\subsection{Digitální podpisy}

RSA, ElGamal, DSA, ECDSA, ověření certifikátu, blockchain, PKCS\#1, X.509, \dots

\begin{center}
{\huge \dots} zde je třeba doplnit zbytek {\huge \dots} \\
(vlastně sám nevím co by tu přesně mělo být)
\end{center}

\clearpage
\section{Hašovací funkce -- vlastnosti, princip, použití, kolize, odolnost proti kolizím, příklady.}

Hashovací funkce slouží k~vyjádření reprezentace dat pomocí krátného řetězce. Jejími požadavky jsou \textbf{jednosměrnost} (z~hashe nelze získat původní data), \textbf{bezkoliznost} (vytvořit dva soubory se~stejným otiskem je velmi obtížné až~nemožné) a~\textbf{rychlost}.

Bezkoliznost prvního řádu (\emph{preimage resistance}) zabraňuje nalezení vzoru, bezkoliznost řádu druhého (\emph{second preimage resistance}) zabraňuje ke~zprávě $m_1$ nalézt $m_2$ takovou, aby platilo $h(m_1) = h(m_2)$.

\subsection{Konstrukce}

Jedním ze~způsobů je rozdělení na~$n$-bitové bloky, které jsou zpracovány XOR. Je možné bloky řetězit: $h_i = E(m_i, h_{i-1})$, použít kompresní funkci ($h_i = f(m_i, h_{i-1})$). Před vstupem do~iteračního procesu se zarovnává poslední blok a~přidává se za~ním blok s~délkou zprávy (tzv. Damgard-Merklovo zesílení).

\subsection{Využití}

\textbf{Zkrácení zprávy} na~její otisk (pro~digitální podpisy), \textbf{autentizace}, zrychlení vyhledávání v~databázích, \textbf{hesla}, PRNG, \dots.


\subsection{Kolize}

Na~běžné současné hashovací funkce neexistují způsoby, jakými by šla původní data získat. Proto je nutné použít útok hrubou silou a~zkoušet jeden vstup za~druhým. % TODO Rainbow tables

Pro~kolizi prvního řádu (nalezení vzoru) je složitost $O(2^n)$, kde $n$ je délka původní zprávy. Pro~kolizi druhého řádu (nalezení kolizního souboru) je složitost $(O^{n/2})$, což vyplývá z~tzv.~narozeninového paradoxu\footnote{
Stačí 23 náhodně vybraných lidí k~tomu, aby se s~pravděpodobností 50~\% našla dvojice, která má narozeniny ve~stejný den, u~skupiny třiceti lidí je pravděpodobnost 70~\%. Pravděpodobnost, že nikdo shodný datum narozenin mít nebude, je $\bar{p}(n) = \frac{365!}{365^n(365 - n)!}$. Obrácené tvrzení $p(n) = 1 - \bar{p}(n)$ překračuje hranici 0.5 pro~$n=23$.
Tomuto útoku se říká \href{https://cs.wikipedia.org/wiki/Narozeninový_útok}{narozeninový útok} a narozeninovou hranici lze spočítat právě jako $2^{n/2}$.
}.

\subsection{Příklady}

128b \textbf{LM~Hash} je stará funkce využívaná v~OS Windows od~osmdesátých let do~verze Vista/Server 2008, v~nejnovějších systémech je možné ji zapnout. Dva (\emph{null-padded}) bloky po~sedmi bajtech jsou zašifrovány dvěma DES klíči a~spojeny zpět k~sobě. \\
128b \textbf{MD5} aplikuje 64 rund (XOR, bit shift, posouvání subbloků, \dots). Poprvé plně prolomena v~roce 2004, od~roku 2010 oficiálně prohlášena za~nedostatečně bezpečnou. Stále je možné ji používat jako kontrolu integrity. \\
224b/256b/384b/512b \textbf{SHA-2} se sada hashovacích funkcí využívajících XOR, \emph{bit shift} a~modulární sčítání. Existují útoky na~oslabené verze (méně rund), všechny funkce z~této rodiny jsou považovány za~bezpečné. \\
224b/256b/384b/512b \textbf{SHA-3} využívá algoritmus Keccak (\enquote{princip houby}) a~je součást SHA rodiny od~roku 2015.

\clearpage
\section{PKI -- certifikát X.509 struktura, certifikační autorita základní části, časová razítka, autorita časových razítek.}

\clearpage
\section{Generování náhodných čísel -- kryptografické generátory, požadavky, použití, princip, testování generátorů.}

Hlavními požadavky na~RNG jsou \textbf{rovnoměrné rozložení} (hodnoty jsou generovány se~stejnou pravděpodobností), \textbf{nezávislost hodnot} (neexistuje korelace mezi nimi), \textbf{nepredikovatelnost} (na~základě znalosti čísla nebo řady čísel nelze předpovědět následující, tzv. \emph{next-bit test}) a~často také \textbf{rychlé generování} nebo odolnost vůči kompromitaci (při~zjištění vnitřního stavu nelze zpětně rekonstruovat dosavadní vygenerovanou posloupnost, tzv. \emph{state compromise}). \emph{Next-bit} ochrana a~zábrana kompromitaci jsou požadavky kryptograficky bezpečných generátorů.

K~vytvoření dostatečného počtu (pseudo)náhodných čísel je nutná dostatečná entropie (míra náhodnosti/nepředvídatelnosti). Když útočník následující hodnotu zná, entropie je nulová. Lze ji vyjádřit jako $H(X) = - \sum_{i=1}^{n} p_i \log_2 p_i$ kde $X$ je generovaná hodnota, $p_1, \dots, p_n$ jsou pravděpodobnosti hodnot $X_1, \dots, X_n$ které je generátor schopen vygenerovat.

\subsection{Typy generátorů}

\subsubsection*{Fyzikální generátory (TRNG)}

Teoreticky jsou nedeterministické, nejsou ale známy přesné parametry, kterými by se daly popsat a~modelovat. Zaručují maximální bezpečnost a~neopakovatelnost. Nevýhodou je pomalé generování či~problematická technická realizace. Příklady: radioaktivní rozpad, tepelný šum, kvantové generátory.

\subsubsection*{Algoritmické generátory (PRNG)}

Posloupnost náhodná není, pokud útočníkovi nejsou známy některé parametry generátoru. Výhodami je rychlost, nízká odchylka od~poměru 1:1 nebo snadná realizace. Nevýhodami jsou bezpečnost či~periodicita. Příklady: čas, teplota HW komponent, šum na~\emph{low-level} sběrnicích (USB, pohyb myši), pohyb HDD.

\subsubsection*{Smíšené generátory}

TRNG z~fyzikálního generátoru se~spojí s~PRNG výstupem pomocí XOR.

\subsection{Příklady realizace PRNG}

\textbf{Bloková šifra v~režimu čítače}: náhodně se zvolí klíč a~počáteční hodnota $i$; zvoleným klíčem se šifrují hodnoty $i, i+1, \dots$ -- perioda u~$n$-bitové šifry je $2^n$. \\
\textbf{Hashovací funkce aplikovaná na~čítač}: hashuje se $i, i+1, \dots$. \\
\textbf{Proudové šifry}: viz otázku \ref{question-4}.

\subsection{Konkrétní příklady}

\textbf{\href{https://en.wikipedia.org/wiki/Blum_Blum_Shub}{Blum-Blum-Shub PRNG}} má formu $x_{n+1} = x_n^2 \Mod M$ (kde $M = pq$ je násobek dvou velkých prvočísel), výstup je~získán pomocí bitové parity výsledku, nebo z~jednoho či více nejméně významých bitů. Byl navrhnut v~roce 1986. \emph{Seed} by mělo být číslo nesoudělné s~$M$, s~vyloučením $\{0, 1\}$.

\textbf{Linuxový PRNG} sbírá události (myš, klávesnice, HDD, síť, \emph{system interrupts}, systémový čas). Zdroj \texttt{/dev/random} je blokující (při~nedostatku entropie se~čeká), na~rozdíl od~\texttt{/dev/urandom} (\emph{unblocked random}), kdy je vráceno \enquote{méně náhodné číslo}.

\textbf{EGD (Entropy Gathering Daemon)} využívají některé linuxové programy (OpenSSL, GPG, Apache HTTP) pokud není dostatečné množství náhodných bitů v~\texttt{/dev/random}. Entropii sbírá ve~stavu CPU, IO nebo sítě.

\subsection{Testování}

K~ověření vlastností PRNG se využívají statistické testy. Odhalí nekvalitní PRNG, ale neprokážou kvalitní PRNG. Testy vrací $p$-hodnotu, která vyjadřuje sílu důkazů proti nulové hypotéze (\enquote{Testovaná posloupnost je nádhodná.}). Pokdu $p$-hodnota překročí určitou mez, nulovou hypotézu považujeme za~neplatnou.

\textbf{Frekvenční test}: Obsahuje testovaná posloupnost bitů přibližně stejný počet nul a~jedniček? \textbf{Runs test}: Je počet a~délka řetězců po~sobě jdoucích stejných bitů na~úrovni náhodné posloupnosti? \textbf{Test hodností matic}, \textbf{spektrální test}.

\clearpage
\section{Bezpečnostní architektura RM OSI -- služby bezpečnosti, mechanizmy bezpečnosti, útoky na bezpečnost, příklady implementace bezpečnostních mechanizmů v jednotlivých vrstvách.}
